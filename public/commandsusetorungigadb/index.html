<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Commands use to run gigadb | kencho51</title><meta name=keywords content="gigadb,yii2,docker,psql"><meta name=description content="Commands for running and testing Local gigaDB"><meta name=author content="Ken Cho"><link rel=canonical href=http://localhost:1313/commandsusetorungigadb/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/commandsusetorungigadb/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/commandsusetorungigadb/"><meta property="og:site_name" content="kencho51"><meta property="og:title" content="Commands use to run gigadb"><meta property="og:description" content="Commands for running and testing Local gigaDB"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2020-07-24T16:03:12+08:00"><meta property="article:modified_time" content="2021-12-09T11:35:08+08:00"><meta property="article:tag" content="Gigadb"><meta property="article:tag" content="Yii2"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Psql"><meta name=twitter:card content="summary"><meta name=twitter:title content="Commands use to run gigadb"><meta name=twitter:description content="Commands for running and testing Local gigaDB"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/post/"},{"@type":"ListItem","position":2,"name":"Commands use to run gigadb","item":"http://localhost:1313/commandsusetorungigadb/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Commands use to run gigadb","name":"Commands use to run gigadb","description":"Commands for running and testing Local gigaDB","keywords":["gigadb","yii2","docker","psql"],"articleBody":"To start a local gigaDB server docker-compose run --rm webapp\nLink to test if the web page is up\nIf there are some build errors Rebuild and up the webapp containers again.\ndocker-compose run --rm webapp If not work, restart the docker container app and rebuild the containers. If not work, check if psql, gigadb, database is presented in ~/.containers/-data and remove it.\nrm -rf ~/.containers-data/gigadb Run docker-compose run --rm webapp again to rebuild the containers. How to remove images List all images\ndocker images -a Remove all images\ndocker rmi $(docker images -a -q) How to remove container List all containers\ndocker ps -a Stop the containers\ndocker stop $(docker ps -a -q) Remove stopped containers\ndocker rm $(docker ps -a -q)\nsource\ndigital ocean How to run a functional test in a docker environment for testing? Write unit test script and place in protected/tests/functional-test folder. Change the unit_functional script ./bin/phpunit protected/tests/functional-test --verbose --configuration protected/tests/phpunit.xml --no-coverage Run specific unit test:\ndocker-compose run --rm test ./tests/unit_functional Output will be like this: PHPUnit 5.7.27 by Sebastian Bergmann and contributors. Runtime: PHP 7.1.30 with Xdebug 2.9.6 Configuration: /var/www/protected/tests/phpunit.xml ... 3 / 3 (100%) Time: 7.15 seconds, Memory: 14.00MB OK (3 tests, 7 assertions) How to run a functional test on a single file in docker environment? docker oneliner\ndocker-compose run --rm test ./bin/phpunit --testsuite functional --bootstrap protected/tests/bootstrap.php --verbose --configuration protected/tests/phpunit.xml --no-coverage protected/tests/functional/AdminSiteAccessTest.php Or go into docker bash and run phpunit\ndocker-compose run --rm test bash\nroot@45a46a8441d3:/var/www# ./bin/phpunit --testsuite functional --bootstrap protected/tests/bootstrap.php --verbose --configuration protected/tests/phpunit.xml --no-coverage protected/tests/functional/AdminSiteAccessTest.php root@45a46a8441d3:/var/www# ./bin/phpunit --testsuite functional --bootstrap protected/tests/bootstrap.php --verbose --configuration protected/tests/phpunit.xml --no-coverage protected/tests/functional/AdminSiteAccessTest.php PHPUnit 5.7.27 by Sebastian Bergmann and contributors. Runtime: PHP 7.1.30 with Xdebug 2.9.6 Configuration: /var/www/protected/tests/phpunit.xml ... 3 / 3 (100%) Time: 4.18 seconds, Memory: 14.00MB OK (3 tests, 7 assertions) How to run a Behat test in a docker environment for testing Update the scenario syntax specific *.feature file, like: @ok @files Scenario: Files - Call to Actions Given I am not logged in to Gigadb web site When I go to \"/dataset/101001\" And I follow \"Files\" Then I should see a link \"(FTP site)\" to \"ftp://climb.genomics.cn/pub/10.5524/101001_102000/101001/\" with title \"FTP site\" Then I should see a button \"Table Settings\" Check if related functions in features/bootstrap/*.php needed to be updated, eg: public function iShouldSeeTabWithTable($arg1, TableNode $table) { if (\"Funding\" == $arg1) { $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003eclickLink($arg1); //| Funding body | Awardee | Award ID | Comments | foreach($table as $row) { PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Funding body']) ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Awardee']) ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Award ID']) ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Comments']) ); } } elseif(\"Files\" == $arg1) { //| File name | Sample ID | Data Type | File Format | Size | Release date | link | foreach($table as $row) { $link = $row['link']; PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['File name']), \"File name match\" ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Sample ID']), \"Sample ID match\" ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Data Type']), \"Data Type match\" ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['File Format']), \"File Format match\" ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Size']), \"Size match\" ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Release date']), \"Release date match\" ); if ($link) { $this-\u003eminkContext-\u003eassertSession()-\u003eelementExists('css',\"a.download-btn[href='$link']\"); } } } elseif(\"Sample\" == $arg1) { //| Sample ID | Common Name | Scientific Name | Sample Attributes | Taxonomic ID | Genbank Name | foreach($table as $row) { PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Sample ID']), \"Sample ID match\" ); if($row['Common Name']) { PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Common Name']), \"Common Name match\" ); } PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Scientific Name']), \"Scientific Name match\" ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Sample Attributes']), \"Sample Attributes match\" ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Taxonomic ID']), \"Taxonomic ID match\" ); PHPUnit_Framework_Assert::assertTrue( $this-\u003eminkContext-\u003egetSession()-\u003egetPage()-\u003ehasContent($row['Genbank Name']), \"Genbank Name match\" ); } } else { PHPUnit_Framework_Assert::fail(\"Unknown type of tab\"); } } Assign @wip tag to the working scenario in .feature file, this can smooth the running of behat test. @wip @files Scenario: Files - Call to Actions Given I am not logged in to Gigadb web site When I go to \"/dataset/101001\" Run the Behat test command on specific scenario.\ndocker-compose run --rm test bin/behat -vv --stop-on-failure --tags @wip\nOr can first shell into test container and then run the command:\n$ docker-compose run --rm test bash root@2f0dd679a934:/var/www# bin/behat --tags @wip How to run a behat test with database set up In all_and_coverage file #!/usr/bin/env bash set -e -u ./tests/acceptance #./tests/unit_functional #./tests/coverage In acceptance file #!/usr/bin/env bash set -e -u -x echo \"About to run automated tests...\" echo \"Loading environment...\" set -a source /var/www/.env source /var/www/.secrets set +a if [ \"$GIGADB_ENV\" == \"dev\" ];then echo \"First, backup the main database...\" exec 3\u003e\u00261 exec 1\u003e /dev/null pg_dump $GIGADB_DB -U $GIGADB_USER -h $GIGADB_HOST -F custom -f /var/www/sql/before-run.pgdmp exec 1\u003e\u00263 fi echo \"Running acceptance tests\" if [[ \"$GIGADB_ENV\" == \"dev\" ]];then #\tbin/behat --tags \"@ok\u0026\u0026~@facebook\u0026\u0026~orcid\" -v --stop-on-failure bin/behat --tags \"@wip\" -v --stop-on-failure else # we are on CI with remote runner, affilate login tests don't work becasause Google and Twitter block it bin/behat --tags \"@ok\u0026\u0026~@affiliate-login\u0026\u0026~@javascript\" -v --stop-on-failure fi echo \"...all automated tests have run\" if [ \"$GIGADB_ENV\" == \"dev\" ];then echo \"Lastly, restoring the main database...\" exec 3\u003e\u00261 exec 1\u003e /dev/null pg_restore -h $GIGADB_HOST -U $GIGADB_USER -d $GIGADB_DB --clean --no-owner -v /var/www/sql/before-run.pgdmp exec 1\u003e\u00263 fi Run the behat test\ndocker-compose run --rm test How to connect postgreSQL in PhpStorm Click Database top right of PhpStorm screen. Data Source chose postgreSQL and input following information: Host: localhost Port: 54321 User: gigadb pw: URL: jdbc:postgresql://localhost:54321/gigadb How to restore gigadb database for admin log in Log in psql container\nPGPASSWORD=vagrant psql -h localhost -p 54321 -U gigadb postgres Terminate runing gigadb SELECT pg_terminate_backend(pg_stat_activity.pid) FROM pg_stat_activity WHERE pg_stat_activity.datname = 'gigadb'; Drop gigadb drop DATABASE gigadb; 4.Create gigadb\ncreate DATABASE gigadb; Restore gigadb from bootstrap.sql\nkencho@MacBook-Pro:% psql -h localhost -U gigadb -p 54321 gigadb \u003c ops/configuration/postgresql-conf/bootstrap.sql How to retrieve production-like database Log in psql container\nPGPASSWORD=vagrant psql -h localhost -p 54321 -U gigadb postgres Create database production_like\npostgres=# create database production_like; Restore production-like database\nkencho@MacBook-Pro:% pg_restore -h localhost -p 54321 -U gigadb -d production_like --clean --no-owner -v sql/production_like.pgdmp How to retrieve text production-like back up database # Drop into bash in test container % docker-compose run --rm test bash # Use psql in test container to connect to gigadb database in database container root@16b04afd18d5:/var/www# psql -h database -p 5432 -U gigadb gigadb gigadb=# create database gigadbv3_20210920; # Dump in the database % psql -h localhost -p 54321 -U gigadb -d gigadbv3_20210920 \u003c gigadb/app/tools/files-url-updater/sql/gigadbv3_20210920_v9.3.25.backup How to convert production database into different version, issue #731, PR190 First version, which involves too many manipulation of the database, and the binary backup has been indexed which are specific to a database server #!/usr/bin/env bash # Load environment variables source ./.env source ./.secrets latest=$(date -v-1d +\"%Y%m%d\") # docker-compose executable if [[ $GIGADB_ENV != \"dev\" \u0026\u0026 $GIGADB_ENV != \"CI\" ]];then DOCKER_COMPOSE=\"docker-compose --tlsverify -H=$REMOTE_DOCKER_HOST -f ops/deployment/docker-compose.production-envs.yml\" else DOCKER_COMPOSE=\"docker-compose\" fi echo \"Spin up the database container\" docker-compose up -d --build database echo \"Go into docker container and store the postgreSQL version\" version=$($DOCKER_COMPOSE run --rm test bash -c \"psql --version | cut -d' ' -f 3 | tr -d '\\n'\") echo \"Download the production database using file-url-updater\" cd gigadb/app/tools/files-url-updater/ docker-compose run --rm updater ./yii dataset-files/download-restore-backup --latest --norestore cd ../../../../ echo \"Create production database for the version upgrade\" $DOCKER_COMPOSE run --rm test bash -c \"psql -h database -U gigadb -c 'create database gigadbv3_production'\" echo \"Load the production database into PostgreSQL server\" $DOCKER_COMPOSE run --rm test bash -c \"PGPASSWORD=$GIGADB_PASSWORD pg_restore -v -U gigadb -h database -p 5432 -d gigadbv3_production /var/www/gigadb/app/tools/files-url-updater/sql/gigadbv3_${latest}.backup\" echo \"Create folder for database dump if not existed\" if [[ ! -d sql/psql-v96 ]];then mkdir sql/psql-v96 fi echo \"Dump the production database\" #$DOCKER_COMPOSE run --rm test bash -c \"PGPASSWORD=$GIGADB_PASSWORD pg_dump -v -U gigadb -h database -p 5432 -d gigadbv3_production -f /var/www/sql/psql-v96/gigadbv3_${latest}_${version}.sql\" $DOCKER_COMPOSE run --rm test bash -c \"PGPASSWORD=$GIGADB_PASSWORD pg_dump -v -U gigadb -h database -p 5432 -Fc -d gigadbv3_production -f /var/www/sql/psql-v96/gigadbv3_${latest}_${version}.pgdmp\" if [[ -f sql/psql-v96/gigadbv3_\"$latest\"_\"$version\".pgdmp ]];then echo \"Finished convert production database to postgreSQL version\" \"$version\" else echo \"No upgraded database dump found, conversion fail!\" fi echo \"Load the upgraded dump into PostgreSQL server\" $DOCKER_COMPOSE run --rm test bash -c \"PGPASSWORD=$GIGADB_PASSWORD pg_restore -v -U gigadb -h database -p 5432 --clean -d gigadbv3_production /var/www/sql/psql-v96/gigadbv3_${latest}_${version}.pgdmp\" if [[ $? -eq 0 ]];then echo \"The upgraded dump could be restored!\" else echo \"The upgraded dump could not be restored, please check!\" fi echo \"Drop production database after upgraded dump has been restored\" $DOCKER_COMPOSE run --rm test bash -c \"psql -h database -U gigadb -c 'drop database gigadbv3_production'\" echo \"Stop database container\" docker stop deployment_database_1 Second version, make use of files-url-updater to restore the production database and dump it in text format. #!/usr/bin/env bash # Load environment variables source ./.env source ./.secrets latest=$(date -v-1d +\"%Y%m%d\") # docker-compose executable if [[ $GIGADB_ENV != \"dev\" \u0026\u0026 $GIGADB_ENV != \"CI\" ]];then DOCKER_COMPOSE=\"docker-compose --tlsverify -H=$REMOTE_DOCKER_HOST -f ops/deployment/docker-compose.production-envs.yml\" else DOCKER_COMPOSE=\"docker-compose\" fi echo \"Download and load the production database in to postgreSQL server using file-url-updater\" cd gigadb/app/tools/files-url-updater/ version=$($DOCKER_COMPOSE run --rm pg9_3 bash -c \"psql --version | cut -d' ' -f 3 | tr -d '\\n'\") $DOCKER_COMPOSE run --rm updater ./yii dataset-files/download-restore-backup --latest echo \"Export production data as text (only the strictly necessary data is exported)\" $DOCKER_COMPOSE run --rm updater pg_dump -h pg9_3 -U gigadb --clean --create --schema=public --no-privileges --no-tablespaces gigadb -f sql/gigadbv3_\"$latest\"_v\"$version\".backup if [[ $? -eq 0 \u0026\u0026 -f sql/gigadbv3_\"$latest\"_v\"$version\".backup ]];then echo \"Finished convert production database to postgreSQL version\" \"$version\" else echo \"No upgraded database dump found, conversion fail!\" fi Reference Run specific behat test gigaDB github ","wordCount":"1525","inLanguage":"en","datePublished":"2020-07-24T16:03:12+08:00","dateModified":"2021-12-09T11:35:08+08:00","author":{"@type":"Person","name":"Ken Cho"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/commandsusetorungigadb/"},"publisher":{"@type":"Organization","name":"kencho51","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="kencho51 (Alt + H)">kencho51</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/page/about/ title=About><span>About</span></a></li><li><a href=http://localhost:1313/post title=Tech><span>Tech</span></a></li><li><a href=http://localhost:1313/projects/ title=Projects><span>Projects</span></a></li><li><a href=http://localhost:1313/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Commands use to run gigadb</h1><div class=post-description>Commands for running and testing Local gigaDB</div><div class=post-meta><span title='2020-07-24 16:03:12 +0800 HKT'>July 24, 2020</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1525 words&nbsp;·&nbsp;Ken Cho</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#to-start-a-local-gigadb-server aria-label="To start a local gigaDB server">To start a local gigaDB server</a></li><li><a href=#if-there-are-some-build-errors aria-label="If there are some build errors">If there are some build errors</a></li><li><a href=#how-to-remove-images aria-label="How to remove images">How to remove images</a></li><li><a href=#how-to-remove-container aria-label="How to remove container">How to remove container</a></li><li><a href=#how-to-run-a-functional-test-in-a-docker-environment-for-testing aria-label="How to run a functional test in a docker environment for testing?">How to run a functional test in a docker environment for testing?</a></li><li><a href=#how-to-run-a-functional-test-on-a-single-file-in-docker-environment aria-label="How to run a functional test on a single file in docker environment?">How to run a functional test on a single file in docker environment?</a></li><li><a href=#how-to-run-a-behat-test-in-a-docker-environment-for-testing aria-label="How to run a Behat test in a docker environment for testing">How to run a Behat test in a docker environment for testing</a></li><li><a href=#how-to-run-a-behat-test-with-database-set-up aria-label="How to run a behat test with database set up">How to run a behat test with database set up</a></li><li><a href=#how-to-connect-postgresql-in-phpstorm aria-label="How to connect postgreSQL in PhpStorm">How to connect postgreSQL in PhpStorm</a></li><li><a href=#how-to-restore-gigadb-database-for-admin-log-in aria-label="How to restore gigadb database for admin log in">How to restore gigadb database for admin log in</a></li><li><a href=#how-to-retrieve-production-like-database aria-label="How to retrieve production-like database">How to retrieve production-like database</a></li><li><a href=#how-to-retrieve-text-production-like-back-up-database aria-label="How to retrieve text production-like back up database">How to retrieve text production-like back up database</a></li><li><a href=#how-to-convert-production-database-into-different-version-issue-731-pr190 aria-label="How to convert production database into different version, issue #731, PR190">How to convert production database into different version, issue #731, PR190</a></li><li><a href=#reference aria-label=Reference>Reference</a></li></ul></div></details></div><div class=post-content><h3 id=to-start-a-local-gigadb-server>To start a local gigaDB server<a hidden class=anchor aria-hidden=true href=#to-start-a-local-gigadb-server>#</a></h3><p><code>docker-compose run --rm webapp</code><br><a href=http://gigadb.gigasciencejournal.com:9170/>Link</a> to test if the web page is up</p><h3 id=if-there-are-some-build-errors>If there are some build errors<a hidden class=anchor aria-hidden=true href=#if-there-are-some-build-errors>#</a></h3><ol><li>Rebuild and up the webapp containers again.<br><code>docker-compose run --rm webapp</code></li><li>If not work, <code>restart</code> the docker container app and rebuild the containers.</li><li>If not work, check if psql, <code>gigadb</code>, database is presented in <code>~/.containers/-data</code> and remove it.<br><code>rm -rf ~/.containers-data/gigadb</code></li><li>Run <code>docker-compose run --rm webapp</code> again to rebuild the containers.</li></ol><h3 id=how-to-remove-images>How to remove images<a hidden class=anchor aria-hidden=true href=#how-to-remove-images>#</a></h3><ol><li>List all images<br><code>docker images -a</code></li><li>Remove all images<br><code>docker rmi $(docker images -a -q)</code></li></ol><h3 id=how-to-remove-container>How to remove container<a hidden class=anchor aria-hidden=true href=#how-to-remove-container>#</a></h3><ol><li>List all containers<br><code>docker ps -a</code></li><li>Stop the containers<br><code>docker stop $(docker ps -a -q)</code></li><li>Remove stopped containers<br><code>docker rm $(docker ps -a -q)</code><br><a href=https://linuxize.com/post/how-to-remove-docker-images-containers-volumes-and-networks/>source</a><br><a href=https://www.digitalocean.com/community/tutorials/how-to-remove-docker-images-containers-and-volumes>digital ocean</a></li></ol><h3 id=how-to-run-a-functional-test-in-a-docker-environment-for-testing>How to run a functional test in a docker environment for testing?<a hidden class=anchor aria-hidden=true href=#how-to-run-a-functional-test-in-a-docker-environment-for-testing>#</a></h3><ol><li>Write unit test script and place in <code>protected/tests/functional-test</code> folder.</li><li>Change the <code>unit_functional</code> script
<code>./bin/phpunit protected/tests/functional-test --verbose --configuration protected/tests/phpunit.xml --no-coverage</code></li><li>Run specific unit test:<br><code>docker-compose run --rm test ./tests/unit_functional</code></li><li>Output will be like this:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PHPUnit 5.7.27 by Sebastian Bergmann and contributors.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Runtime:       PHP 7.1.30 with Xdebug 2.9.6
</span></span><span class=line><span class=cl>Configuration: /var/www/protected/tests/phpunit.xml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...                                                                 <span class=m>3</span> / <span class=m>3</span> <span class=o>(</span>100%<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Time: 7.15 seconds, Memory: 14.00MB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OK <span class=o>(</span><span class=m>3</span> tests, <span class=m>7</span> assertions<span class=o>)</span>
</span></span></code></pre></div><h3 id=how-to-run-a-functional-test-on-a-single-file-in-docker-environment>How to run a functional test on a single file in docker environment?<a hidden class=anchor aria-hidden=true href=#how-to-run-a-functional-test-on-a-single-file-in-docker-environment>#</a></h3><ol><li>docker oneliner<br><code>docker-compose run --rm test ./bin/phpunit --testsuite functional --bootstrap protected/tests/bootstrap.php --verbose --configuration protected/tests/phpunit.xml --no-coverage protected/tests/functional/AdminSiteAccessTest.php</code></li><li>Or go into docker bash and run <code>phpunit</code><br><code>docker-compose run --rm test bash</code><br><code>root@45a46a8441d3:/var/www# ./bin/phpunit --testsuite functional --bootstrap protected/tests/bootstrap.php --verbose --configuration protected/tests/phpunit.xml --no-coverage protected/tests/functional/AdminSiteAccessTest.php</code></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@45a46a8441d3:/var/www# ./bin/phpunit --testsuite functional --bootstrap protected/tests/bootstrap.php --verbose --configuration protected/tests/phpunit.xml --no-coverage protected/tests/functional/AdminSiteAccessTest.php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PHPUnit 5.7.27 by Sebastian Bergmann and contributors.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Runtime:       PHP 7.1.30 with Xdebug 2.9.6
</span></span><span class=line><span class=cl>Configuration: /var/www/protected/tests/phpunit.xml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>...                                                                 <span class=m>3</span> / <span class=m>3</span> <span class=o>(</span>100%<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Time: 4.18 seconds, Memory: 14.00MB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OK <span class=o>(</span><span class=m>3</span> tests, <span class=m>7</span> assertions<span class=o>)</span>
</span></span></code></pre></div><h3 id=how-to-run-a-behat-test-in-a-docker-environment-for-testing>How to run a Behat test in a docker environment for testing<a hidden class=anchor aria-hidden=true href=#how-to-run-a-behat-test-in-a-docker-environment-for-testing>#</a></h3><ol><li>Update the <code>scenario syntax</code> specific *.feature file, like:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-gherkin data-lang=gherkin><span class=line><span class=cl><span class=nt>@ok</span><span class=nf> </span><span class=nt>@files</span><span class=nf>
</span></span></span><span class=line><span class=cl><span class=nf>	</span><span class=k>Scenario:</span><span class=nf> Files - Call to Actions
</span></span></span><span class=line><span class=cl><span class=nf></span><span class=k>		Given </span><span class=nf>I am not logged in to Gigadb web site
</span></span></span><span class=line><span class=cl><span class=nf>		</span><span class=k>When </span><span class=nf>I go to &#34;</span><span class=s>/dataset/101001</span><span class=nf>&#34;
</span></span></span><span class=line><span class=cl><span class=nf>		</span><span class=k>And </span><span class=nf>I follow &#34;</span><span class=s>Files</span><span class=nf>&#34;
</span></span></span><span class=line><span class=cl><span class=nf>		</span><span class=k>Then </span><span class=nf>I should see a link &#34;</span><span class=s>(FTP site)</span><span class=nf>&#34; to &#34;</span><span class=s>ftp://climb.genomics.cn/pub/10.5524/101001_102000/101001/</span><span class=nf>&#34; with title &#34;</span><span class=s>FTP site</span><span class=nf>&#34;
</span></span></span><span class=line><span class=cl><span class=nf>		</span><span class=k>Then </span><span class=nf>I should see a button &#34;</span><span class=s>Table Settings</span><span class=nf>&#34;
</span></span></span></code></pre></div><ol start=2><li>Check if related functions in <code>features/bootstrap/*.php</code> needed to be updated, eg:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>iShouldSeeTabWithTable</span><span class=p>(</span><span class=nv>$arg1</span><span class=p>,</span> <span class=nx>TableNode</span> <span class=nv>$table</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=s2>&#34;Funding&#34;</span> <span class=o>==</span> <span class=nv>$arg1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>clickLink</span><span class=p>(</span><span class=nv>$arg1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=c1>//| Funding body                    | Awardee           | Award ID      | Comments |
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>foreach</span><span class=p>(</span><span class=nv>$table</span> <span class=k>as</span> <span class=nv>$row</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Funding body&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Awardee&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Award ID&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Comments&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>elseif</span><span class=p>(</span><span class=s2>&#34;Files&#34;</span> <span class=o>==</span> <span class=nv>$arg1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>//| File name                                        | Sample ID  | Data Type         | File Format | Size      | Release date | link |
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>foreach</span><span class=p>(</span><span class=nv>$table</span> <span class=k>as</span> <span class=nv>$row</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$link</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;link&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;File name&#39;</span><span class=p>]),</span> <span class=s2>&#34;File name match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Sample ID&#39;</span><span class=p>]),</span> <span class=s2>&#34;Sample ID match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Data Type&#39;</span><span class=p>]),</span> <span class=s2>&#34;Data Type match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;File Format&#39;</span><span class=p>]),</span> <span class=s2>&#34;File Format match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Size&#39;</span><span class=p>]),</span> <span class=s2>&#34;Size match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Release date&#39;</span><span class=p>]),</span> <span class=s2>&#34;Release date match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=nv>$link</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>assertSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>elementExists</span><span class=p>(</span><span class=s1>&#39;css&#39;</span><span class=p>,</span><span class=s2>&#34;a.download-btn[href=&#39;</span><span class=si>$link</span><span class=s2>&#39;]&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>elseif</span><span class=p>(</span><span class=s2>&#34;Sample&#34;</span> <span class=o>==</span> <span class=nv>$arg1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=c1>//| Sample ID  | Common Name  | Scientific Name         | Sample Attributes                                                                                                                   | Taxonomic ID | Genbank Name |
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>foreach</span><span class=p>(</span><span class=nv>$table</span> <span class=k>as</span> <span class=nv>$row</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Sample ID&#39;</span><span class=p>]),</span> <span class=s2>&#34;Sample ID match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Common Name&#39;</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Common Name&#39;</span><span class=p>]),</span> <span class=s2>&#34;Common Name match&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Scientific Name&#39;</span><span class=p>]),</span> <span class=s2>&#34;Scientific Name match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Sample Attributes&#39;</span><span class=p>]),</span> <span class=s2>&#34;Sample Attributes match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Taxonomic ID&#39;</span><span class=p>]),</span> <span class=s2>&#34;Taxonomic ID match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>assertTrue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>minkContext</span><span class=o>-&gt;</span><span class=na>getSession</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>getPage</span><span class=p>()</span><span class=o>-&gt;</span><span class=na>hasContent</span><span class=p>(</span><span class=nv>$row</span><span class=p>[</span><span class=s1>&#39;Genbank Name&#39;</span><span class=p>]),</span> <span class=s2>&#34;Genbank Name match&#34;</span>
</span></span><span class=line><span class=cl>                <span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>PHPUnit_Framework_Assert</span><span class=o>::</span><span class=na>fail</span><span class=p>(</span><span class=s2>&#34;Unknown type of tab&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><ol start=3><li>Assign @wip tag to the working scenario in .feature file, this can smooth the running of behat test.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-gherkin data-lang=gherkin><span class=line><span class=cl><span class=nt>@wip</span><span class=nf> </span><span class=nt>@files</span><span class=nf>
</span></span></span><span class=line><span class=cl><span class=nf>	</span><span class=k>Scenario:</span><span class=nf> Files - Call to Actions
</span></span></span><span class=line><span class=cl><span class=nf></span><span class=k>		Given </span><span class=nf>I am not logged in to Gigadb web site
</span></span></span><span class=line><span class=cl><span class=nf>		</span><span class=k>When </span><span class=nf>I go to &#34;</span><span class=s>/dataset/101001</span><span class=nf>&#34;
</span></span></span></code></pre></div><ol start=4><li><p>Run the Behat test command on specific scenario.<br><code>docker-compose run --rm test bin/behat -vv --stop-on-failure --tags @wip</code></p></li><li><p>Or can first shell into test container and then run the command:</p></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ docker-compose run --rm <span class=nb>test</span> bash
</span></span><span class=line><span class=cl>root@2f0dd679a934:/var/www# bin/behat --tags @wip
</span></span></code></pre></div><h3 id=how-to-run-a-behat-test-with-database-set-up>How to run a behat test with database set up<a hidden class=anchor aria-hidden=true href=#how-to-run-a-behat-test-with-database-set-up>#</a></h3><ol><li>In <code>all_and_coverage</code> file</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -e -u
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>./tests/acceptance
</span></span><span class=line><span class=cl><span class=c1>#./tests/unit_functional</span>
</span></span><span class=line><span class=cl><span class=c1>#./tests/coverage</span>
</span></span></code></pre></div><ol start=2><li>In <code>acceptance</code> file</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -e -u -x
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;About to run  automated tests...&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Loading environment...&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> -a
</span></span><span class=line><span class=cl><span class=nb>source</span> /var/www/.env
</span></span><span class=line><span class=cl><span class=nb>source</span> /var/www/.secrets
</span></span><span class=line><span class=cl><span class=nb>set</span> +a
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$GIGADB_ENV</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;dev&#34;</span> <span class=o>]</span><span class=p>;</span><span class=k>then</span>
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> <span class=s2>&#34;First, backup the main database...&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nb>exec</span> 3&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span><span class=line><span class=cl>	<span class=nb>exec</span> 1&gt; /dev/null
</span></span><span class=line><span class=cl>	pg_dump <span class=nv>$GIGADB_DB</span> -U <span class=nv>$GIGADB_USER</span> -h <span class=nv>$GIGADB_HOST</span> -F custom  -f /var/www/sql/before-run.pgdmp
</span></span><span class=line><span class=cl>	<span class=nb>exec</span> 1&gt;<span class=p>&amp;</span><span class=m>3</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Running acceptance tests&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=s2>&#34;</span><span class=nv>$GIGADB_ENV</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;dev&#34;</span> <span class=o>]]</span><span class=p>;</span><span class=k>then</span>
</span></span><span class=line><span class=cl><span class=c1>#	bin/behat --tags &#34;@ok&amp;&amp;~@facebook&amp;&amp;~orcid&#34; -v --stop-on-failure</span>
</span></span><span class=line><span class=cl>    bin/behat --tags <span class=s2>&#34;@wip&#34;</span> -v --stop-on-failure
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>	<span class=c1># we are on CI with remote runner, affilate login tests don&#39;t work becasause Google and Twitter block it</span>
</span></span><span class=line><span class=cl>	bin/behat --tags <span class=s2>&#34;@ok&amp;&amp;~@affiliate-login&amp;&amp;~@javascript&#34;</span> -v --stop-on-failure
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;...all automated tests have run&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;</span><span class=nv>$GIGADB_ENV</span><span class=s2>&#34;</span> <span class=o>==</span> <span class=s2>&#34;dev&#34;</span> <span class=o>]</span><span class=p>;</span><span class=k>then</span>
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> <span class=s2>&#34;Lastly, restoring the main database...&#34;</span>
</span></span><span class=line><span class=cl>	<span class=nb>exec</span> 3&gt;<span class=p>&amp;</span><span class=m>1</span>
</span></span><span class=line><span class=cl>	<span class=nb>exec</span> 1&gt; /dev/null
</span></span><span class=line><span class=cl>	pg_restore -h <span class=nv>$GIGADB_HOST</span>  -U <span class=nv>$GIGADB_USER</span> -d <span class=nv>$GIGADB_DB</span> --clean --no-owner -v /var/www/sql/before-run.pgdmp
</span></span><span class=line><span class=cl>	<span class=nb>exec</span> 1&gt;<span class=p>&amp;</span><span class=m>3</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><ol start=3><li>Run the behat test<br><code>docker-compose run --rm test</code></li></ol><h3 id=how-to-connect-postgresql-in-phpstorm>How to connect postgreSQL in PhpStorm<a hidden class=anchor aria-hidden=true href=#how-to-connect-postgresql-in-phpstorm>#</a></h3><ol><li>Click Database top right of PhpStorm screen.</li><li>Data Source chose <code>postgreSQL</code> and input following information:<ul><li>Host: localhost</li><li>Port: 54321</li><li>User: gigadb</li><li>pw:</li><li>URL: <code>jdbc:postgresql://localhost:54321/gigadb</code></li></ul></li></ol><h3 id=how-to-restore-gigadb-database-for-admin-log-in>How to restore gigadb database for admin log in<a hidden class=anchor aria-hidden=true href=#how-to-restore-gigadb-database-for-admin-log-in>#</a></h3><ol><li>Log in psql container<br><code>PGPASSWORD=vagrant psql -h localhost -p 54321 -U gigadb postgres</code></li><li>Terminate runing <code>gigadb</code></li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>pg_terminate_backend</span><span class=p>(</span><span class=n>pg_stat_activity</span><span class=p>.</span><span class=n>pid</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>pg_stat_activity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=n>pg_stat_activity</span><span class=p>.</span><span class=n>datname</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;gigadb&#39;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><ol start=3><li>Drop gigadb</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>drop</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>gigadb</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>4.Create gigadb</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>DATABASE</span><span class=w> </span><span class=n>gigadb</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><ol start=5><li>Restore <code>gigadb</code> from <code>bootstrap.sql</code><br><code>kencho@MacBook-Pro:% psql -h localhost -U gigadb -p 54321 gigadb &lt; ops/configuration/postgresql-conf/bootstrap.sql</code></li></ol><h3 id=how-to-retrieve-production-like-database>How to retrieve production-like database<a hidden class=anchor aria-hidden=true href=#how-to-retrieve-production-like-database>#</a></h3><ol><li>Log in psql container<br><code>PGPASSWORD=vagrant psql -h localhost -p 54321 -U gigadb postgres</code></li><li>Create database <code>production_like</code><br><code>postgres=# create database production_like;</code></li><li>Restore production-like database<br><code>kencho@MacBook-Pro:% pg_restore -h localhost -p 54321 -U gigadb -d production_like --clean --no-owner -v sql/production_like.pgdmp</code></li></ol><h3 id=how-to-retrieve-text-production-like-back-up-database>How to retrieve text production-like back up database<a hidden class=anchor aria-hidden=true href=#how-to-retrieve-text-production-like-back-up-database>#</a></h3><pre tabindex=0><code># Drop into bash in test container
% docker-compose run --rm test bash
# Use psql in test container to connect to gigadb database in database container
root@16b04afd18d5:/var/www# psql -h database -p 5432 -U gigadb gigadb
gigadb=# create database gigadbv3_20210920;
# Dump in the database
% psql -h localhost -p 54321 -U gigadb -d gigadbv3_20210920 &lt; gigadb/app/tools/files-url-updater/sql/gigadbv3_20210920_v9.3.25.backup
</code></pre><h3 id=how-to-convert-production-database-into-different-version-issue-731-pr190>How to convert production database into different version, issue <a href=https://github.com/gigascience/gigadb-website/issues/731>#731</a>, <a href=https://github.com/rija/gigadb-website/pull/190>PR190</a><a hidden class=anchor aria-hidden=true href=#how-to-convert-production-database-into-different-version-issue-731-pr190>#</a></h3><ol><li>First version, which involves too many manipulation of the database, and the binary backup has been indexed which are specific to a database server</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># Load environment variables</span>
</span></span><span class=line><span class=cl><span class=nb>source</span> ./.env
</span></span><span class=line><span class=cl><span class=nb>source</span> ./.secrets
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=nv>latest</span><span class=o>=</span><span class=k>$(</span>date -v-1d +<span class=s2>&#34;%Y%m%d&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=c1># docker-compose executable</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$GIGADB_ENV</span> !<span class=o>=</span> <span class=s2>&#34;dev&#34;</span> <span class=o>&amp;&amp;</span> <span class=nv>$GIGADB_ENV</span> !<span class=o>=</span> <span class=s2>&#34;CI&#34;</span> <span class=o>]]</span><span class=p>;</span><span class=k>then</span>
</span></span><span class=line><span class=cl>	<span class=nv>DOCKER_COMPOSE</span><span class=o>=</span><span class=s2>&#34;docker-compose --tlsverify -H=</span><span class=nv>$REMOTE_DOCKER_HOST</span><span class=s2> -f ops/deployment/docker-compose.production-envs.yml&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl> <span class=nv>DOCKER_COMPOSE</span><span class=o>=</span><span class=s2>&#34;docker-compose&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Spin up the database container&#34;</span>
</span></span><span class=line><span class=cl>docker-compose up -d --build database
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Go into docker container and store the postgreSQL version&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>version</span><span class=o>=</span><span class=k>$(</span><span class=nv>$DOCKER_COMPOSE</span> run --rm <span class=nb>test</span> bash -c <span class=s2>&#34;psql --version | cut -d&#39; &#39; -f 3 | tr -d &#39;\n&#39;&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Download the production database using file-url-updater&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> gigadb/app/tools/files-url-updater/
</span></span><span class=line><span class=cl>docker-compose run --rm updater ./yii dataset-files/download-restore-backup --latest --norestore
</span></span><span class=line><span class=cl><span class=nb>cd</span> ../../../../
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Create production database for the version upgrade&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$DOCKER_COMPOSE</span> run --rm <span class=nb>test</span> bash -c <span class=s2>&#34;psql -h database -U gigadb -c &#39;create database gigadbv3_production&#39;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Load the production database into PostgreSQL server&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$DOCKER_COMPOSE</span> run --rm <span class=nb>test</span> bash -c <span class=s2>&#34;PGPASSWORD=</span><span class=nv>$GIGADB_PASSWORD</span><span class=s2> pg_restore -v -U gigadb -h database -p 5432 -d gigadbv3_production /var/www/gigadb/app/tools/files-url-updater/sql/gigadbv3_</span><span class=si>${</span><span class=nv>latest</span><span class=si>}</span><span class=s2>.backup&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Create folder for database dump if not existed&#34;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> ! -d sql/psql-v96 <span class=o>]]</span><span class=p>;</span><span class=k>then</span>
</span></span><span class=line><span class=cl>mkdir sql/psql-v96
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Dump the production database&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>#$DOCKER_COMPOSE run --rm test bash -c &#34;PGPASSWORD=$GIGADB_PASSWORD pg_dump -v -U gigadb -h database -p 5432 -d gigadbv3_production -f /var/www/sql/psql-v96/gigadbv3_${latest}_${version}.sql&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$DOCKER_COMPOSE</span> run --rm <span class=nb>test</span> bash -c <span class=s2>&#34;PGPASSWORD=</span><span class=nv>$GIGADB_PASSWORD</span><span class=s2> pg_dump -v -U gigadb -h database -p 5432 -Fc -d gigadbv3_production -f /var/www/sql/psql-v96/gigadbv3_</span><span class=si>${</span><span class=nv>latest</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>.pgdmp&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> -f sql/psql-v96/gigadbv3_<span class=s2>&#34;</span><span class=nv>$latest</span><span class=s2>&#34;</span>_<span class=s2>&#34;</span><span class=nv>$version</span><span class=s2>&#34;</span>.pgdmp <span class=o>]]</span><span class=p>;</span><span class=k>then</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Finished convert production database to postgreSQL version&#34;</span> <span class=s2>&#34;</span><span class=nv>$version</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;No upgraded database dump found, conversion fail!&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Load the upgraded dump into PostgreSQL server&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$DOCKER_COMPOSE</span> run --rm <span class=nb>test</span> bash -c <span class=s2>&#34;PGPASSWORD=</span><span class=nv>$GIGADB_PASSWORD</span><span class=s2> pg_restore -v -U gigadb -h database -p 5432 --clean -d gigadbv3_production /var/www/sql/psql-v96/gigadbv3_</span><span class=si>${</span><span class=nv>latest</span><span class=si>}</span><span class=s2>_</span><span class=si>${</span><span class=nv>version</span><span class=si>}</span><span class=s2>.pgdmp&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$?</span> -eq <span class=m>0</span> <span class=o>]]</span><span class=p>;</span><span class=k>then</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;The upgraded dump could be restored!&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;The upgraded dump could not be restored, please check!&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Drop production database after upgraded dump has been restored&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$DOCKER_COMPOSE</span> run --rm <span class=nb>test</span> bash -c <span class=s2>&#34;psql -h database -U gigadb -c &#39;drop database gigadbv3_production&#39;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Stop database container&#34;</span>
</span></span><span class=line><span class=cl>docker stop deployment_database_1
</span></span></code></pre></div><ol start=2><li>Second version, make use of <code>files-url-updater</code> to restore the production database and dump it in text format.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/usr/bin/env bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1># Load environment variables</span>
</span></span><span class=line><span class=cl><span class=nb>source</span> ./.env
</span></span><span class=line><span class=cl><span class=nb>source</span> ./.secrets
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>latest</span><span class=o>=</span><span class=k>$(</span>date -v-1d +<span class=s2>&#34;%Y%m%d&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># docker-compose executable</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$GIGADB_ENV</span> !<span class=o>=</span> <span class=s2>&#34;dev&#34;</span> <span class=o>&amp;&amp;</span> <span class=nv>$GIGADB_ENV</span> !<span class=o>=</span> <span class=s2>&#34;CI&#34;</span> <span class=o>]]</span><span class=p>;</span><span class=k>then</span>
</span></span><span class=line><span class=cl>	<span class=nv>DOCKER_COMPOSE</span><span class=o>=</span><span class=s2>&#34;docker-compose --tlsverify -H=</span><span class=nv>$REMOTE_DOCKER_HOST</span><span class=s2> -f ops/deployment/docker-compose.production-envs.yml&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>	<span class=nv>DOCKER_COMPOSE</span><span class=o>=</span><span class=s2>&#34;docker-compose&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Download and load the production database in to postgreSQL server using file-url-updater&#34;</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> gigadb/app/tools/files-url-updater/
</span></span><span class=line><span class=cl><span class=nv>version</span><span class=o>=</span><span class=k>$(</span><span class=nv>$DOCKER_COMPOSE</span> run --rm pg9_3 bash -c <span class=s2>&#34;psql --version | cut -d&#39; &#39; -f 3 | tr -d &#39;\n&#39;&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nv>$DOCKER_COMPOSE</span> run --rm updater ./yii dataset-files/download-restore-backup --latest
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;Export production data as text (only the strictly necessary data is exported)&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$DOCKER_COMPOSE</span> run --rm updater pg_dump -h pg9_3 -U gigadb  --clean --create --schema<span class=o>=</span>public --no-privileges --no-tablespaces gigadb -f sql/gigadbv3_<span class=s2>&#34;</span><span class=nv>$latest</span><span class=s2>&#34;</span>_v<span class=s2>&#34;</span><span class=nv>$version</span><span class=s2>&#34;</span>.backup
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[[</span> <span class=nv>$?</span> -eq <span class=m>0</span>  <span class=o>&amp;&amp;</span> -f sql/gigadbv3_<span class=s2>&#34;</span><span class=nv>$latest</span><span class=s2>&#34;</span>_v<span class=s2>&#34;</span><span class=nv>$version</span><span class=s2>&#34;</span>.backup <span class=o>]]</span><span class=p>;</span><span class=k>then</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;Finished convert production database to postgreSQL version&#34;</span> <span class=s2>&#34;</span><span class=nv>$version</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;No upgraded database dump found, conversion fail!&#34;</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></div><h3 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h3><ol><li><a href=https://github.com/gigascience/gigadb-website/issues/356>Run specific behat test</a></li><li><a href=https://github.com/gigascience/gigadb-website/tree/develop>gigaDB github</a></li></ol><p><a href=https://travis-ci.org/kencho51/gigathing><img alt="Build Status" loading=lazy src="https://travis-ci.org/kencho51/gigathing.svg?branch=master"></a></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/gigadb/>Gigadb</a></li><li><a href=http://localhost:1313/tags/yii2/>Yii2</a></li><li><a href=http://localhost:1313/tags/docker/>Docker</a></li><li><a href=http://localhost:1313/tags/psql/>Psql</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/howtogotopagebtn/><span class=title>« Prev</span><br><span>How to make go to page feature</span>
</a><a class=next href=http://localhost:1313/whatsinterestinginbcc2020/><span class=title>Next »</span><br><span>Whats interesting in BCC2020</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Commands use to run gigadb on x" href="https://x.com/intent/tweet/?text=Commands%20use%20to%20run%20gigadb&amp;url=http%3a%2f%2flocalhost%3a1313%2fcommandsusetorungigadb%2f&amp;hashtags=gigadb%2cyii2%2cdocker%2cpsql"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Commands use to run gigadb on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fcommandsusetorungigadb%2f&amp;title=Commands%20use%20to%20run%20gigadb&amp;summary=Commands%20use%20to%20run%20gigadb&amp;source=http%3a%2f%2flocalhost%3a1313%2fcommandsusetorungigadb%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Commands use to run gigadb on telegram" href="https://telegram.me/share/url?text=Commands%20use%20to%20run%20gigadb&amp;url=http%3a%2f%2flocalhost%3a1313%2fcommandsusetorungigadb%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>kencho51</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>