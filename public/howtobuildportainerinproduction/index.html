<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to build portainer in production | kencho51</title><meta name=keywords content="docker,portainer,nginx,reverse proxy"><meta name=description content="Steps to build portainer in production"><meta name=author content="Ken Cho"><link rel=canonical href=http://localhost:1313/howtobuildportainerinproduction/><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/howtobuildportainerinproduction/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/howtobuildportainerinproduction/"><meta property="og:site_name" content="kencho51"><meta property="og:title" content="How to build portainer in production"><meta property="og:description" content="Steps to build portainer in production"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-11-15T13:45:42+08:00"><meta property="article:modified_time" content="2021-11-15T13:53:22+08:00"><meta property="article:tag" content="Docker"><meta property="article:tag" content="Portainer"><meta property="article:tag" content="Nginx"><meta property="article:tag" content="Reverse Proxy"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to build portainer in production"><meta name=twitter:description content="Steps to build portainer in production"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/post/"},{"@type":"ListItem","position":2,"name":"How to build portainer in production","item":"http://localhost:1313/howtobuildportainerinproduction/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to build portainer in production","name":"How to build portainer in production","description":"Steps to build portainer in production","keywords":["docker","portainer","nginx","reverse proxy"],"articleBody":"GigaDB Portainer service What is portainer? Portainer is an open-source management UI for Docker, including Docker Swarm environment. Portainer makes it easier for you to manage your Docker containers, it allows you to manage containers, images, networks, and volumes from the web-based Portainer dashboard.\nPre-requisites The staging server and live server are up and running. Here and here are the details of how to provision and configure an EC2 server using Ansible and Terraform. The Let’s Encrypt certificate fallout has been fixed by getting the latest code from this PR #198. Have Docker Hub account, and store DOCKER_HUB_USERNAME and DOCKER_HUB_PASSWORD which is the access token in gitlab CI/CD variables. Steps to configure the portainer, details can be found at this PR #201 Changes to the DNS record Create an A record for access portainer on staging and on live as following: Record name Type IP portainer.$staging_url A staging server IP portainer.$live_url A live server IP Changes to the gitlab variables Create a new variable as following: Key Value Environment PORTAINER_PASSWORD “Password” All(default) DOCKER_HUB_USERNAME “User name” All(default) DOCKER_HUB_PASSWORD “Access token” All(default) Variable PORTAINER_BCRYPT (if any) could be deleted.\nChanges to the nginx configuration\nAdd server blocks to route all request from portainer.$staging/live_url to http://portainer:9000. How to know portainer is configured correctly A. On dev environment\nIn terminal % curl -I localhost:9009 HTTP/1.1 200 OK Accept-Ranges: bytes Cache-Control: max-age=31536000 Content-Length: 6176 Content-Type: text/html; charset=utf-8 Last-Modified: Sun, 10 Oct 2021 23:45:45 GMT X-Content-Type-Options: nosniff X-Xss-Protection: 1; mode=block Date: Sun, 17 Oct 2021 03:25:38 GMT And visit http://localhost:9009/ B. On staging or live servers\nIn terminal $ curl -I localhost:9009 HTTP/1.1 200 OK Accept-Ranges: bytes Cache-Control: max-age=31536000 Content-Length: 6176 Content-Type: text/html; charset=utf-8 Last-Modified: Sun, 10 Oct 2021 23:45:45 GMT X-Content-Type-Options: nosniff X-Xss-Protection: 1; mode=block Date: Sun, 17 Oct 2021 03:28:39 GMT And visit portainer on staging or portainer on live Reference Official protainer doc Unable to access portainer URL with custom context path apart nginx and portainer on non-root URI Reference ","wordCount":"327","inLanguage":"en","datePublished":"2021-11-15T13:45:42+08:00","dateModified":"2021-11-15T13:53:22+08:00","author":{"@type":"Person","name":"Ken Cho"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/howtobuildportainerinproduction/"},"publisher":{"@type":"Organization","name":"kencho51","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="kencho51 (Alt + H)">kencho51</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/page/about/ title=About><span>About</span></a></li><li><a href=http://localhost:1313/post title=Tech><span>Tech</span></a></li><li><a href=http://localhost:1313/projects/ title=Projects><span>Projects</span></a></li><li><a href=http://localhost:1313/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/post/>Posts</a></div><h1 class="post-title entry-hint-parent">How to build portainer in production</h1><div class=post-description>Steps to build portainer in production</div><div class=post-meta><span title='2021-11-15 13:45:42 +0800 HKT'>November 15, 2021</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;327 words&nbsp;·&nbsp;Ken Cho</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#gigadb-portainer-service aria-label="GigaDB Portainer service">GigaDB Portainer service</a><ul><ul><li><a href=#what-is-portainer aria-label="What is portainer?">What is portainer?</a></li><li><a href=#pre-requisites aria-label=Pre-requisites>Pre-requisites</a></li><li><a href=#steps-to-configure-the-portainer-details-can-be-found-at-this-pr-201 aria-label="Steps to configure the portainer, details can be found at this PR #201">Steps to configure the portainer, details can be found at this PR #201</a><ul><li><a href=#how-to-know-portainer-is-configured-correctly aria-label="How to know portainer is configured correctly">How to know portainer is configured correctly</a></li></ul></li><li><a href=#reference aria-label=Reference>Reference</a></li><li><a href=#reference-1 aria-label=Reference>Reference</a></li></ul></ul></li></ul></div></details></div><div class=post-content><h1 id=gigadb-portainer-service>GigaDB Portainer service<a hidden class=anchor aria-hidden=true href=#gigadb-portainer-service>#</a></h1><h3 id=what-is-portainer>What is portainer?<a hidden class=anchor aria-hidden=true href=#what-is-portainer>#</a></h3><p>Portainer is an open-source management UI for Docker, including Docker Swarm environment. Portainer makes it easier for you to manage your Docker containers, it allows you to manage containers, images, networks, and volumes from the web-based Portainer dashboard.</p><h3 id=pre-requisites>Pre-requisites<a hidden class=anchor aria-hidden=true href=#pre-requisites>#</a></h3><ol><li>The staging server and live server are up and running. <a href=(https://gist.github.com/rija/343128de50e68d28f3537af7619a14bd)>Here</a> and <a href=https://github.com/gigascience/gigadb-website/blob/develop/docs/SETUP_CI_CD_PIPELINE.md>here</a> are the details of how to provision and configure an EC2 server using Ansible and Terraform.</li><li>The Let&rsquo;s Encrypt certificate fallout has been fixed by getting the latest code from this <a href=https://github.com/rija/gigadb-website/pull/198>PR #198</a>.</li><li>Have Docker Hub account, and store <code>DOCKER_HUB_USERNAME</code> and <code>DOCKER_HUB_PASSWORD</code> which is the access token in gitlab CI/CD variables.</li></ol><h3 id=steps-to-configure-the-portainer-details-can-be-found-at-this-pr-201>Steps to configure the portainer, details can be found at this <a href=https://github.com/rija/gigadb-website/pull/201>PR #201</a><a hidden class=anchor aria-hidden=true href=#steps-to-configure-the-portainer-details-can-be-found-at-this-pr-201>#</a></h3><ol><li>Changes to the DNS record
Create an <code>A</code> record for access portainer on staging and on live as following:</li></ol><table><thead><tr><th>Record name</th><th>Type</th><th>IP</th></tr></thead><tbody><tr><td>portainer.$staging_url</td><td>A</td><td>staging server IP</td></tr><tr><td>portainer.$live_url</td><td>A</td><td>live server IP</td></tr></tbody></table><ol start=2><li>Changes to the gitlab variables
Create a new variable as following:</li></ol><table><thead><tr><th>Key</th><th>Value</th><th>Environment</th></tr></thead><tbody><tr><td>PORTAINER_PASSWORD</td><td>&ldquo;Password&rdquo;</td><td>All(default)</td></tr><tr><td>DOCKER_HUB_USERNAME</td><td>&ldquo;User name&rdquo;</td><td>All(default)</td></tr><tr><td>DOCKER_HUB_PASSWORD</td><td>&ldquo;Access token&rdquo;</td><td>All(default)</td></tr></tbody></table><p>Variable <code>PORTAINER_BCRYPT</code> (if any) could be deleted.</p><ol start=3><li>Changes to the <code>nginx</code> configuration<br>Add server blocks to route all request from <code>portainer.$staging/live_url</code> to <code>http://portainer:9000</code>.</li></ol><h4 id=how-to-know-portainer-is-configured-correctly>How to know portainer is configured correctly<a hidden class=anchor aria-hidden=true href=#how-to-know-portainer-is-configured-correctly>#</a></h4><p>A. On <code>dev</code> environment</p><ol><li>In terminal</li></ol><pre tabindex=0><code>% curl -I localhost:9009
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: max-age=31536000
Content-Length: 6176
Content-Type: text/html; charset=utf-8
Last-Modified: Sun, 10 Oct 2021 23:45:45 GMT
X-Content-Type-Options: nosniff
X-Xss-Protection: 1; mode=block
Date: Sun, 17 Oct 2021 03:25:38 GMT
</code></pre><ol start=2><li>And visit <code>http://localhost:9009/</code></li></ol><p>B. On staging or live servers</p><ol><li>In terminal</li></ol><pre tabindex=0><code>$ curl -I localhost:9009
HTTP/1.1 200 OK
Accept-Ranges: bytes
Cache-Control: max-age=31536000
Content-Length: 6176
Content-Type: text/html; charset=utf-8
Last-Modified: Sun, 10 Oct 2021 23:45:45 GMT
X-Content-Type-Options: nosniff
X-Xss-Protection: 1; mode=block
Date: Sun, 17 Oct 2021 03:28:39 GMT
</code></pre><ol start=2><li>And visit <a href=https://portainer.ec2-staging.gigadb.link/>portainer on staging</a> or <a href=https://portainer.ec2-live.gigadb.link/>portainer on live</a></li></ol><h3 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h3><ol><li><a href=https://docs.portainer.io/v/ce-2.9/start/intro>Official protainer doc</a></li><li><a href=https://github.com/portainer/portainer/issues/4483>Unable to access portainer URL with custom context path apart</a></li><li><a href=https://github.com/portainer/portainer/issues/3303>nginx and portainer on non-root URI</a></li></ol><h3 id=reference-1>Reference<a hidden class=anchor aria-hidden=true href=#reference-1>#</a></h3><p><a href=https://travis-ci.com/kencho51/gigathing><img alt="Build Status" loading=lazy src="https://travis-ci.com/kencho51/gigathing.svg?branch=master"></a></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/docker/>Docker</a></li><li><a href=http://localhost:1313/tags/portainer/>Portainer</a></li><li><a href=http://localhost:1313/tags/nginx/>Nginx</a></li><li><a href=http://localhost:1313/tags/reverse-proxy/>Reverse Proxy</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/howyiimigrationscriptworks/><span class=title>« Prev</span><br><span>How Yii migration script works</span>
</a><a class=next href=http://localhost:1313/howtoaddportainer/><span class=title>Next »</span><br><span>How to add portainer for monitoring dockers</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share How to build portainer in production on x" href="https://x.com/intent/tweet/?text=How%20to%20build%20portainer%20in%20production&amp;url=http%3a%2f%2flocalhost%3a1313%2fhowtobuildportainerinproduction%2f&amp;hashtags=docker%2cportainer%2cnginx%2creverseproxy"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to build portainer in production on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fhowtobuildportainerinproduction%2f&amp;title=How%20to%20build%20portainer%20in%20production&amp;summary=How%20to%20build%20portainer%20in%20production&amp;source=http%3a%2f%2flocalhost%3a1313%2fhowtobuildportainerinproduction%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share How to build portainer in production on telegram" href="https://telegram.me/share/url?text=How%20to%20build%20portainer%20in%20production&amp;url=http%3a%2f%2flocalhost%3a1313%2fhowtobuildportainerinproduction%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>kencho51</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>